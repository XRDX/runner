function Rect(t,e,n,i,o){this.type=ShapeTypes.rect,this.x=t,this.y=e,this.w=n,this.h=i,this.c=o||"orange"}function FillRect(t,e,n,i,o){Rect.call(this,t,e,n,i,o)}function LImage(t,e,n,i,o){Rect.call(this,e,n,i,o),this.type=ShapeTypes.image,this.img=t}function Animation(t,e,n,i,o,s,r,c,a){LImage.call(this,t,e,n,i,o),this.type=ShapeTypes.animation,this.frameMax=c||this.img.fs,this.currentFrame=0,this.sw=s||this.img.w,this.sh=r||this.img.h,this.animationFrame=a||5}function Circle(t,e,n,i){this.type=ShapeTypes.circle,this.x=t,this.y=e,this.r=n,this.c=i||"orange"}function FillCircle(t,e,n,i){Circle.call(this,t,e,n,i)}function Text(t,e,n,i){this.c=i||"orange",this.x=e,this.y=n,this.msg=t}function Scene(){this.shapes=new Array,this.xSpeed=0,this.ySpeed=0,this.transformPosition={x:0,y:0}}function Runner(){Scene.call(this),this.g=1,this.jumpSpeed=-10,this.secondJump=!1}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),LL=function(){function t(t){for(var e in t)o[e]=t[e]}function e(){return s}function n(t){var e=0,n=0
context.font="14px bold",context.lineWidth=5
var i=canvas.width,r=canvas.height
for(var c in o)n++
var a=function(){context.clearRect(0,0,i,r),context.fillStyle="#40eeee",context.fillRect(0,0,i,r),context.fillStyle="orange",context.fillText("Loading:"+e+"/"+n,i/4,r/2-20),context.beginPath(),context.moveTo(i/4,r/2),context.lineTo(3*i/4,r/2),context.strokeStyle="white",context.stroke(),context.closePath(),context.beginPath(),context.moveTo(i/4,r/2),context.lineTo(i/4+i/2*e/n,r/2),context.strokeStyle="orange",context.stroke(),context.closePath()},h=function(){a(),++e>=n&&t&&t()}
for(var c in o)s[c]=new Image,s[c].onload=h,s[c].src=o[c].src,s[c].w=o[c].w,s[c].h=o[c].h,s[c].fs=o[c].fs
a()}var i=function(t,e){var n=Object.create(e.prototype)
n.constructor=t,t.prototype=n},o={},s={}
return{inheritPrototype:i,loadImageAndRun:n,addImages:t,getImages:e}}()
LL.addImages(images),LL.loadImageAndRun()
var Collision=function(){var t=function(t,e){return!(t.x+t.w<e.x)&&(!(t.x>e.x+e.w)&&(!(t.y+t.h<e.y)&&!(t.y>e.y+e.h)))},e=function(t,e){return!(t.x+t.w<e.x-e.r)&&(!(t.x>e.x+e.r)&&(!(t.y+t.h<e.y-e.r)&&!(t.y>e.y+e.r)))},n=function(t,e){return!((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)>(t.r+e.r)*(t.r+e.r))},i=function(t,e){var n={}
return n.x=Math.max(t.x,e.x),n.y=Math.max(t.y,e.y),n.w=Math.min(t.x+t.w,e.x+e.w)-n.x,n.h=Math.min(t.y+t.h,e.y+e.h)-n.y,n},o=document.getElementById("canvas1"),s=document.getElementById("canvas2"),r=o.getContext("2d"),c=s.getContext("2d")
return o.width=s.width=canvas.width,o.height=s.height=canvas.height,{rect2rect:t,rect2circle:e,circle2circle:n,image2image:function(e,n){if(t(e,n)){r.clearRect(0,0,canvas.width,canvas.height),c.clearRect(0,0,canvas.width,canvas.height),e.draw(r),n.draw(c)
var o=i(e,n)
if(o.w<=0||o.h<=0)return!1
for(var s=r.getImageData(o.x,o.y,o.w,o.h),a=c.getImageData(o.x,o.y,o.w,o.h),h=s.data,p=a.data,u=3,l=h.length;u<l;u+=17)if(h[u]&&p[u])return!0
return!1}return!1}}}(),ShapeTypes=Object.freeze({rect:0,circle:1,line:2,triangle:3,image:4,animation:5,text:6})
Rect.prototype.draw=function(){context.strokeStyle=this.c,context.beginPath(),context.rect(this.x,this.y,this.w,this.h),context.closePath(),context.stroke()},Rect.prototype.collide=function(t){switch(t.type){case ShapeTypes.rect:return Collision.rect2rect(this,t)
case ShapeTypes.circle:return Collision.rect2circle(this,t)
default:return!1}},Rect.prototype.transform=function(t,e){this.x+=t,this.y+=e},LL.inheritPrototype(FillRect,Rect),FillRect.prototype.draw=function(){context.fillStyle=this.c,context.fillRect(this.x,this.y,this.w,this.h)},LL.inheritPrototype(LImage,Rect),LImage.prototype.draw=function(t){this.w=this.w||Math.floor(this.img.w/2),this.h=this.h||Math.floor(this.img.h/2),t?t.drawImage(this.img,this.x,this.y,this.w,this.h):context.drawImage(this.img,this.x,this.y,this.w,this.h)},LImage.prototype.collide=function(t){switch(t.type){case ShapeTypes.rect:return Collision.rect2rect(this,t)
case ShapeTypes.circle:return Collision.rect2circle(this,t)
case ShapeTypes.image:case ShapeTypes.animation:return Collision.image2image(this,t)
default:return!1}},LL.inheritPrototype(Animation,LImage),Animation.prototype.draw=function(t){var e=Math.floor(this.currentFrame/this.animationFrame),n=this.sw*e
this.w=this.w||Math.floor(this.img.w/2),this.h=this.h||Math.floor(this.img.h/2),t?t.drawImage(this.img,n,0,this.sw,this.sh,this.x,this.y,this.w,this.h):context.drawImage(this.img,n,0,this.sw,this.sh,this.x,this.y,this.w,this.h),++this.currentFrame>=this.frameMax*this.animationFrame&&(this.currentFrame=0)},Circle.prototype.draw=function(){context.strokeStyle=this.c,context.beginPath(),context.arc(this.x,this.y,this.r,0,2*Math.PI,!0),context.closePath(),context.stroke()},Circle.prototype.collide=function(t){switch(t.type){case ShapeTypes.rect:return Collision.rect2circle(t,this)
case ShapeTypes.circle:return Collision.circle2circle(this,t)
default:return!1}},Circle.prototype.transform=function(t,e){this.x+=t,this.y+=e},LL.inheritPrototype(FillCircle,Circle),FillCircle.prototype.draw=function(){context.fillStyle=this.c,context.beginPath(),context.arc(this.x,this.y,this.r,0,2*Math.PI,!0),context.closePath(),context.fill()},Text.prototype.draw=function(){context.fillStyle=this.c,context.font="15px bold",context.fillText(this.msg,this.x,this.y)},Text.prototype.transform=function(t,e){this.x+=t,this.y+=e},Scene.prototype.rect=function(t,e,n,i,o){var s=new Rect(t,e,n,i,o)
return this.shapes.push(s),this},Scene.prototype.fillRect=function(t,e,n,i,o){var s=new FillRect(t,e,n,i,o)
return this.shapes.push(s),this},Scene.prototype.circle=function(t,e,n,i){var o=new Circle(t,e,n,i)
return this.shapes.push(o),this},Scene.prototype.fillCircle=function(t,e,n,i){var o=new FillCircle(t,e,n,i)
return this.shapes.push(o),this},Scene.prototype.image=function(t,e,n,i,o){var s=new LImage(t,e,n,i,o)
return this.shapes.push(s),this},Scene.prototype.animation=function(t,e,n,i,o,s,r,c,a){var h=new Animation(t,e,n,i,o,s,r,c,a)
return this.shapes.push(h),this},Scene.prototype.text=function(t,e,n,i){var o=new Text(t,e,n,i)
return this.shapes.push(o),this},Scene.prototype.draw=function(){for(var t=0;t<this.shapes.length;t++)this.shapes[t].draw()},Scene.prototype.setXSpeed=function(t){this.xSpeed=t},Scene.prototype.setYSpeed=function(t){this.ySpeed=t},Scene.prototype.update=function(){this.transform(this.xSpeed,this.ySpeed)},Scene.prototype.transform=function(t,e){e=e||0,this.transformPosition.x+=t,this.transformPosition.y+=e
for(var n=0;n<this.shapes.length;n++)this.shapes[n].transform(t,e)},Scene.prototype.getTransform=function(){return this.transformPosition},Scene.prototype.reset=function(){this.transform(-this.transformPosition.x,-this.transformPosition.y)},Scene.prototype.run=function(){this.update(),this.draw()},Scene.prototype.loop=function(){this.run(),this.transformPosition.x<-canvas.width&&(this.reset(),this.transform(canvas.width,0))},Scene.prototype.collide=function(t){for(var e=0;e<this.shapes.length;e++)for(var n=0;n<t.shapes.length;n++)if(this.shapes[e].collide(t.shapes[n]))return!0
return!1},LL.inheritPrototype(Runner,Scene),Runner.prototype.jump=function(){this.isInAir()||(this.setYSpeed(this.jumpSpeed),this.secondJump=!0),this.secondJump&&this.ySpeed>.5*this.jumpSpeed&&(this.setYSpeed(.8*this.jumpSpeed),this.secondJump=!1)},Runner.prototype.isInAir=function(){return this.getTransform().y<0},Runner.prototype.update=function(){this.isInAir()||this.ySpeed<0?this.ySpeed+=this.g:(this.ySpeed=0,this.reset()),Scene.prototype.update.call(this)},Runner.prototype.setGraviry=function(t){this.g=t},Runner.prototype.setJumpSpeed=function(t){this.jumpSpeed=t},LL.RunnerGame=function(){var t,e,n,i,o,s=!1,r=0,c=0,a=[],h=0,p=new Scene,u=new Scene,l=function(){s=!1,r=0,u.reset(),p.reset(),u.transform(canvas.width),p.transform(2*canvas.width),window.requestAnimationFrame(I,canvas)},f=function(){s=!0,c=r>c?r:c},m=function(){e=new Scene,e.setXSpeed(-.8),e.image(IMAGES.bg,0,0,canvas.width,canvas.height),n=new Scene,n.setXSpeed(-.8),n.image(IMAGES.bg,0,0,canvas.width,canvas.height),n.transform(canvas.width,0),i=new Scene,i.setXSpeed(-4),i.image(IMAGES.ground,0,220,canvas.width+10,canvas.height-220),o=new Scene,o.setXSpeed(-4),o.image(IMAGES.ground,0,220,canvas.width+10,canvas.height-220),o.transform(canvas.width,0)},d=function(){t=new Runner,t.animation(IMAGES.guagua,50,172,31,49,61,98,8,5),t.setGraviry(.4),t.setJumpSpeed(-10)},y=function(){m(),d(),g(),document.onkeydown=function(e){32!=e.keyCode||s||t.jump()},document.ontouchstart=function(e){s||t.jump()},document.onmousedown=function(e){s?l():t.jump()},document.ontouchend=function(t){s&&l()},document.onkeyup=function(t){32==t.keyCode&&s&&l()}},x=function(){var t=new Scene
return t.setXSpeed(-4),a.push(t),t},g=function(){w(),w()},w=function(){u=p,0!=a.length&&(p=a[h],p.reset(),p.transform(canvas.width+u.getTransform().x,0),++h>=a.length&&(h=0))},S=function(){context.fillStyle="white",context.font="15px bold",context.drawImage(LL.getImages().score,3,3,20,20),context.fillText(r,25,20),context.drawImage(LL.getImages().hiscore,canvas.width-80,3,20,20),context.fillText(c,canvas.width-55,20),s&&(context.font="18px bold",context.fillText("press SPACE to try again",180,100))},v=function(){e.loop(),n.loop(),i.loop(),o.loop(),p.run(),u.run(),u.getTransform().x<-canvas.width&&w(),t.update(),t.draw(),r+=1,L()&&f()},I=function(){s||(v(),S(),requestAnimationFrame(I))},L=function(){return!(!t.collide(p)&&!t.collide(u))}
return{init:y,loop:I,newScene:x,start:l,getImages:LL.getImages,addImages:LL.addImages,loadImageAndRun:LL.loadImageAndRun,speed:-4}}
